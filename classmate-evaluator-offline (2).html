<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-Powered Classmate Evaluation System">
    <meta name="theme-color" content="#4f46e5">
    <title>ClassMate AI - Peer Evaluation System</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkNsYXNzTWF0ZSBBSSIsCiAgInNob3J0X25hbWUiOiAiQ2xhc3NNYXRlIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwZjE3MmEiLAogICJ0aGVtZV9jb2xvciI6ICIjNGY0NmU1IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxOTInIGhlaWdodD0nMTkyJyUzRSUzQ3JlY3Qgd2lkdGg9JzE5MicgaGVpZ2h0PScxOTInIGZpbGw9JyU0ZjQ2ZTUnLyUzRSUzQ3RleHQgeD0nNTAlMjUnIHk9JzUwJTI1JyBmb250LXNpemU9JzEwMCcgZmlsbD0nd2hpdGUnIGZvbnQtZmFtaWx5PSdBcmlhbCcgdGV4dC1hbmNob3I9J21pZGRsZScgZHk9Jy4zNWVtJyUzRUMlM0MvdGV4dCUzRSUzQy9zdmclM0UiLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB3aWR0aD0nNTEyJyBoZWlnaHQ9JzUxMiclM0UlM0NyZWN0IHdpZHRoPSc1MTInIGhlaWdodD0nNTEyJyBmaWxsPSclNGY0NmU1Jy8lM0UlM0N0ZXh0IHg9JzUwJTI1JyB5PSc1MCUyNScgZm9udC1zaXplPScyNzAnIGZpbGw9J3doaXRlJyBmb250LWZhbWlseT0nQXJpYWwnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGR5PScuMzVlbSclM0VDJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Crect width='180' height='180' fill='%234f46e5'/%3E%3Ctext x='50%25' y='50%25' font-size='95' fill='white' font-family='Arial' text-anchor='middle' dy='.35em'%3EC%3C/text%3E%3C/svg%3E">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #4f46e5;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #6366f1;
        }
        
        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }
        
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
        
        .animate-pulse-glow {
            animation: pulse-glow 3s ease-in-out infinite;
        }
        
        /* Loading spinner */
        .spinner {
            border: 3px solid rgba(79, 70, 229, 0.3);
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Install button */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-950 via-indigo-950 to-purple-950 text-slate-100 min-h-screen">
    
    <!-- Install PWA Button -->
    <div id="installPrompt" class="install-prompt hidden">
        <button id="installButton" class="px-6 py-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 hover:from-indigo-600 hover:via-purple-600 hover:to-pink-600 text-white font-semibold rounded-xl shadow-2xl flex items-center gap-2">
            <span>ðŸ“±</span>
            <span>Install App</span>
        </button>
    </div>
    
    <!-- React App Container -->
    <div id="root"></div>
    
    <!-- React and Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // IndexedDB wrapper for offline storage
        const DB_NAME = 'ClassMateDB';
        const DB_VERSION = 1;
        
        const initDB = () => {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('data')) {
                        db.createObjectStore('data', { keyPath: 'key' });
                    }
                };
            });
        };
        
        const saveToDB = async (key, value) => {
            const db = await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['data'], 'readwrite');
                const store = transaction.objectStore('data');
                const request = store.put({ key, value });
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        };
        
        const getFromDB = async (key) => {
            const db = await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['data'], 'readonly');
                const store = transaction.objectStore('data');
                const request = store.get(key);
                request.onsuccess = () => resolve(request.result?.value);
                request.onerror = () => reject(request.error);
            });
        };
        
        // Lucide Icons
        const Icons = {
            Users: () => React.createElement('i', { 'data-lucide': 'users' }),
            Plus: () => React.createElement('i', { 'data-lucide': 'plus' }),
            TrendingUp: () => React.createElement('i', { 'data-lucide': 'trending-up' }),
            TrendingDown: () => React.createElement('i', { 'data-lucide': 'trending-down' }),
            Award: () => React.createElement('i', { 'data-lucide': 'award' }),
            Calendar: () => React.createElement('i', { 'data-lucide': 'calendar' }),
            X: () => React.createElement('i', { 'data-lucide': 'x' }),
            BarChart3: () => React.createElement('i', { 'data-lucide': 'bar-chart-3' }),
            Eye: () => React.createElement('i', { 'data-lucide': 'eye' }),
            Menu: () => React.createElement('i', { 'data-lucide': 'menu' }),
            Search: () => React.createElement('i', { 'data-lucide': 'search' }),
            Download: () => React.createElement('i', { 'data-lucide': 'download' }),
            Edit2: () => React.createElement('i', { 'data-lucide': 'edit-2' }),
            Trash2: () => React.createElement('i', { 'data-lucide': 'trash-2' }),
            Minus: () => React.createElement('i', { 'data-lucide': 'minus' }),
            ChevronDown: () => React.createElement('i', { 'data-lucide': 'chevron-down' }),
            BookOpen: () => React.createElement('i', { 'data-lucide': 'book-open' }),
            GraduationCap: () => React.createElement('i', { 'data-lucide': 'graduation-cap' }),
            HelpCircle: () => React.createElement('i', { 'data-lucide': 'help-circle' }),
            CheckCircle: () => React.createElement('i', { 'data-lucide': 'check-circle' }),
            Info: () => React.createElement('i', { 'data-lucide': 'info' }),
            Sparkles: () => React.createElement('i', { 'data-lucide': 'sparkles' }),
            Brain: () => React.createElement('i', { 'data-lucide': 'brain' }),
            Zap: () => React.createElement('i', { 'data-lucide': 'zap' }),
            Target: () => React.createElement('i', { 'data-lucide': 'target' }),
            MessageSquare: () => React.createElement('i', { 'data-lucide': 'message-square' }),
            Lightbulb: () => React.createElement('i', { 'data-lucide': 'lightbulb' }),
            LineChart: () => React.createElement('i', { 'data-lucide': 'line-chart' }),
            PieChart: () => React.createElement('i', { 'data-lucide': 'pie-chart' }),
            Activity: () => React.createElement('i', { 'data-lucide': 'activity' }),
            Wifi: () => React.createElement('i', { 'data-lucide': 'wifi' }),
            WifiOff: () => React.createElement('i', { 'data-lucide': 'wifi-off' }),
        };
        
        // Main App Component
        function App() {
            const [classmates, setClassmates] = useState([]);
            const [evaluations, setEvaluations] = useState([]);
            const [activeView, setActiveView] = useState('dashboard');
            const [selectedClassmate, setSelectedClassmate] = useState(null);
            const [showAddClassmate, setShowAddClassmate] = useState(false);
            const [showEvaluate, setShowEvaluate] = useState(false);
            const [isLoading, setIsLoading] = useState(true);
            const [showMobileMenu, setShowMobileMenu] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterClass, setFilterClass] = useState('all');
            const [sortBy, setSortBy] = useState('name');
            const [editingClassmate, setEditingClassmate] = useState(null);
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(null);
            const [showGuide, setShowGuide] = useState(false);
            const [aiInsights, setAiInsights] = useState({});
            const [loadingAI, setLoadingAI] = useState({});
            const [showAIChat, setShowAIChat] = useState(false);
            const [aiChatMessages, setAiChatMessages] = useState([]);
            const [aiChatInput, setAiChatInput] = useState('');
            const [aiChatLoading, setAiChatLoading] = useState(false);
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            
            const criteria = [
                { id: 'academicContribution', name: 'Academic Contribution', weight: 0.25, color: 'from-blue-400 to-cyan-400' },
                { id: 'collaboration', name: 'Collaboration & Teamwork', weight: 0.25, color: 'from-purple-400 to-pink-400' },
                { id: 'communication', name: 'Communication Skills', weight: 0.20, color: 'from-green-400 to-emerald-400' },
                { id: 'participation', name: 'Class Participation', weight: 0.15, color: 'from-orange-400 to-red-400' },
                { id: 'reliability', name: 'Reliability & Punctuality', weight: 0.15, color: 'from-indigo-400 to-purple-400' }
            ];
            
            useEffect(() => {
                loadData();
                lucide.createIcons();
                
                // Online/offline detection
                const handleOnline = () => setIsOnline(true);
                const handleOffline = () => setIsOnline(false);
                
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                
                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);
            
            useEffect(() => {
                lucide.createIcons();
            });
            
            const loadData = async () => {
                try {
                    const [classmatesData, evalsData, insightsData] = await Promise.all([
                        getFromDB('classmates'),
                        getFromDB('evaluations'),
                        getFromDB('aiInsights')
                    ]);
                    
                    if (classmatesData) setClassmates(JSON.parse(classmatesData));
                    if (evalsData) setEvaluations(JSON.parse(evalsData));
                    if (insightsData) setAiInsights(JSON.parse(insightsData));
                } catch (error) {
                    console.error('Error loading data:', error);
                } finally {
                    setIsLoading(false);
                }
            };
            
            const saveData = async (newClassmates, newEvaluations, newInsights) => {
                try {
                    await Promise.all([
                        saveToDB('classmates', JSON.stringify(newClassmates || classmates)),
                        saveToDB('evaluations', JSON.stringify(newEvaluations || evaluations)),
                        saveToDB('aiInsights', JSON.stringify(newInsights || aiInsights))
                    ]);
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            };
            
            const callClaudeAPI = async (prompt, systemPrompt = '') => {
                if (!isOnline) {
                    alert('AI features require an internet connection. You are currently offline.');
                    return null;
                }
                
                try {
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1000,
                            system: systemPrompt || "You are an AI assistant helping with classmate evaluations. Provide concise, helpful insights.",
                            messages: [
                                { role: "user", content: prompt }
                            ],
                        })
                    });
                    
                    const data = await response.json();
                    return data.content.map(item => item.type === "text" ? item.text : "").filter(Boolean).join("\n");
                } catch (error) {
                    console.error('AI Error:', error);
                    alert('AI service is currently unavailable. Please try again later.');
                    return null;
                }
            };
            
            const generateAIInsights = async (classmateId) => {
                setLoadingAI(prev => ({ ...prev, [classmateId]: true }));
                
                const classmate = classmates.find(c => c.id === classmateId);
                const classmateEvals = getClassmateEvaluations(classmateId);
                
                if (classmateEvals.length === 0) {
                    setLoadingAI(prev => ({ ...prev, [classmateId]: false }));
                    return;
                }
                
                const evalData = classmateEvals.map(e => ({
                    date: new Date(e.date).toLocaleDateString(),
                    score: e.overallScore.toFixed(2),
                    ratings: e.ratings,
                    comments: e.comments
                }));
                
                const prompt = `Analyze this student's evaluation data and provide brief insights (3-4 sentences max):

Student: ${classmate.name}
Class: ${classmate.classSection}
Number of evaluations: ${classmateEvals.length}
Average score: ${getAverageScore(classmateId).toFixed(2)}/5.0
Trend: ${getTrend(classmateId)}

Recent evaluations:
${JSON.stringify(evalData, null, 2)}

Provide: 1) Key strengths, 2) Areas for improvement, 3) One specific actionable recommendation.`;
                
                const insights = await callClaudeAPI(prompt);
                
                if (insights) {
                    const newInsights = { ...aiInsights, [classmateId]: { text: insights, timestamp: Date.now() } };
                    setAiInsights(newInsights);
                    await saveData(classmates, evaluations, newInsights);
                }
                
                setLoadingAI(prev => ({ ...prev, [classmateId]: false }));
            };
            
            const generateSmartComment = async (classmateId, ratings) => {
                const avgRating = Object.values(ratings).reduce((a, b) => a + b, 0) / Object.values(ratings).length;
                
                const prompt = `Generate a brief, constructive evaluation comment (2-3 sentences) for a student based on these ratings (1-5 scale):

${criteria.map(c => `${c.name}: ${ratings[c.id] || 0}/5`).join('\n')}

Average: ${avgRating.toFixed(1)}/5

Make it specific, professional, and encouraging. Focus on observed behaviors.`;
                
                const comment = await callClaudeAPI(prompt);
                return comment || '';
            };
            
            const handleAIChat = async (message) => {
                if (!message.trim()) return;
                
                setAiChatMessages(prev => [...prev, { role: 'user', content: message }]);
                setAiChatInput('');
                setAiChatLoading(true);
                
                const context = `You are an AI assistant for a classmate evaluation system. 

Current data:
- Total classmates: ${classmates.length}
- Total evaluations: ${evaluations.length}
- Classes: ${getClasses().filter(c => c !== 'all').join(', ')}

Help the user with questions about their data, evaluation best practices, or insights.`;
                
                const response = await callClaudeAPI(message, context);
                
                if (response) {
                    setAiChatMessages(prev => [...prev, { role: 'assistant', content: response }]);
                }
                
                setAiChatLoading(false);
            };
            
            const addClassmate = async (name, year, classSection) => {
                const newClassmate = {
                    id: Date.now().toString(),
                    name,
                    year,
                    classSection,
                    addedDate: new Date().toISOString()
                };
                const newClassmates = [...classmates, newClassmate];
                setClassmates(newClassmates);
                await saveData(newClassmates, evaluations, aiInsights);
                setShowAddClassmate(false);
            };
            
            const updateClassmate = async (id, name, year, classSection) => {
                const newClassmates = classmates.map(c => 
                    c.id === id ? { ...c, name, year, classSection } : c
                );
                setClassmates(newClassmates);
                await saveData(newClassmates, evaluations, aiInsights);
                setEditingClassmate(null);
            };
            
            const deleteClassmate = async (id) => {
                const newClassmates = classmates.filter(c => c.id !== id);
                const newEvaluations = evaluations.filter(e => e.classmateId !== id);
                const newInsights = { ...aiInsights };
                delete newInsights[id];
                
                setClassmates(newClassmates);
                setEvaluations(newEvaluations);
                setAiInsights(newInsights);
                await saveData(newClassmates, newEvaluations, newInsights);
                setShowDeleteConfirm(null);
                if (selectedClassmate?.id === id) {
                    setSelectedClassmate(null);
                    setActiveView('dashboard');
                }
            };
            
            const deleteEvaluation = async (evalId) => {
                const newEvaluations = evaluations.filter(e => e.id !== evalId);
                setEvaluations(newEvaluations);
                await saveData(classmates, newEvaluations, aiInsights);
            };
            
            const addEvaluation = async (classmateId, ratings, comments) => {
                const weightedScore = criteria.reduce((sum, criterion) => {
                    return sum + (ratings[criterion.id] * criterion.weight);
                }, 0);
                
                const newEval = {
                    id: Date.now().toString(),
                    classmateId,
                    ratings,
                    comments,
                    overallScore: weightedScore,
                    date: new Date().toISOString(),
                    evaluator: 'You'
                };
                const newEvaluations = [...evaluations, newEval];
                setEvaluations(newEvaluations);
                await saveData(classmates, newEvaluations, aiInsights);
                setShowEvaluate(false);
            };
            
            const getClassmateEvaluations = (classmateId) => {
                return evaluations.filter(e => e.classmateId === classmateId).sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                );
            };
            
            const getAverageScore = (classmateId) => {
                const classmateEvals = getClassmateEvaluations(classmateId);
                if (classmateEvals.length === 0) return 0;
                return classmateEvals.reduce((sum, e) => sum + e.overallScore, 0) / classmateEvals.length;
            };
            
            const getTrend = (classmateId) => {
                const classmateEvals = getClassmateEvaluations(classmateId);
                if (classmateEvals.length < 2) return 'stable';
                
                const recent = classmateEvals.slice(0, Math.min(3, classmateEvals.length));
                const older = classmateEvals.slice(Math.min(3, classmateEvals.length));
                
                if (older.length === 0) return 'stable';
                
                const recentAvg = recent.reduce((sum, e) => sum + e.overallScore, 0) / recent.length;
                const olderAvg = older.reduce((sum, e) => sum + e.overallScore, 0) / older.length;
                
                if (recentAvg > olderAvg + 0.3) return 'improving';
                if (recentAvg < olderAvg - 0.3) return 'declining';
                return 'stable';
            };
            
            const getTopPerformers = () => {
                return classmates
                    .map(classmate => ({
                        ...classmate,
                        avgScore: getAverageScore(classmate.id),
                        evalCount: getClassmateEvaluations(classmate.id).length
                    }))
                    .filter(c => c.evalCount > 0)
                    .sort((a, b) => b.avgScore - a.avgScore)
                    .slice(0, 3);
            };
            
            const getClasses = () => {
                return ['all', ...new Set(classmates.map(c => c.classSection))];
            };
            
            const getClassStats = () => {
                const classes = {};
                classmates.forEach(classmate => {
                    if (!classes[classmate.classSection]) {
                        classes[classmate.classSection] = { count: 0, totalScore: 0, evalCount: 0 };
                    }
                    classes[classmate.classSection].count++;
                    const classmateEvals = getClassmateEvaluations(classmate.id);
                    if (classmateEvals.length > 0) {
                        classes[classmate.classSection].totalScore += getAverageScore(classmate.id);
                        classes[classmate.classSection].evalCount++;
                    }
                });
                
                return Object.entries(classes).map(([classSection, stats]) => ({
                    classSection,
                    count: stats.count,
                    avgScore: stats.evalCount > 0 ? stats.totalScore / stats.evalCount : 0
                })).sort((a, b) => b.avgScore - a.avgScore);
            };
            
            const exportToCSV = () => {
                const headers = ['Name', 'Year', 'Class', 'Average Score', 'Evaluations Count', 'Latest Evaluation', 'Trend'];
                const rows = classmates.map(classmate => {
                    const classmateEvals = getClassmateEvaluations(classmate.id);
                    const avgScore = getAverageScore(classmate.id);
                    const trend = getTrend(classmate.id);
                    const latestDate = classmateEvals.length > 0 
                        ? new Date(classmateEvals[0].date).toLocaleDateString() 
                        : 'N/A';
                    
                    return [
                        classmate.name,
                        classmate.year,
                        classmate.classSection,
                        avgScore.toFixed(2),
                        classmateEvals.length,
                        latestDate,
                        trend
                    ];
                });
                
                const csvContent = [
                    headers.join(','),
                    ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `classmate-evaluations-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);
            };
            
            const filteredAndSortedClassmates = () => {
                let filtered = classmates.filter(classmate => {
                    const matchesSearch = classmate.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                         classmate.year.toLowerCase().includes(searchTerm.toLowerCase());
                    const matchesClass = filterClass === 'all' || classmate.classSection === filterClass;
                    return matchesSearch && matchesClass;
                });
                
                filtered.sort((a, b) => {
                    switch(sortBy) {
                        case 'name':
                            return a.name.localeCompare(b.name);
                        case 'score':
                            return getAverageScore(b.id) - getAverageScore(a.id);
                        case 'evaluations':
                            return getClassmateEvaluations(b.id).length - getClassmateEvaluations(a.id).length;
                        case 'class':
                            return a.classSection.localeCompare(b.classSection);
                        default:
                            return 0;
                    }
                });
                
                return filtered;
            };
            
            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-950 via-indigo-950 to-purple-950 flex items-center justify-center px-4">
                        <div className="text-center">
                            <div className="w-16 h-16 spinner mx-auto mb-4"></div>
                            <div className="text-indigo-300 text-xl font-light">Loading your data...</div>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-950 via-indigo-950 to-purple-950 text-slate-100">
                    {/* Animated Background */}
                    <div className="fixed inset-0 overflow-hidden pointer-events-none">
                        <div className="absolute -top-1/2 -left-1/2 w-full h-full bg-gradient-to-br from-indigo-500/10 to-purple-500/10 rounded-full blur-3xl animate-pulse-glow"></div>
                        <div className="absolute -bottom-1/2 -right-1/2 w-full h-full bg-gradient-to-tl from-pink-500/10 to-indigo-500/10 rounded-full blur-3xl animate-pulse-glow" style={{animationDelay: '1s'}}></div>
                    </div>
                    
                    {/* Header */}
                    <header className="border-b border-indigo-500/20 bg-slate-950/80 backdrop-blur-xl sticky top-0 z-50 shadow-2xl shadow-indigo-500/10">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3 sm:gap-4">
                                    <div className="relative">
                                        <div className="absolute inset-0 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-2xl blur-lg opacity-75 animate-pulse-glow"></div>
                                        <div className="relative w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-indigo-400 via-purple-400 to-pink-400 rounded-2xl flex items-center justify-center transform rotate-6 shadow-2xl">
                                            <Icons.GraduationCap />
                                        </div>
                                    </div>
                                    <div>
                                        <h1 className="text-xl sm:text-3xl font-bold tracking-tight bg-gradient-to-r from-indigo-300 via-purple-300 to-pink-300 bg-clip-text text-transparent">
                                            ClassMate AI
                                        </h1>
                                        <p className="text-slate-400 text-xs sm:text-sm mt-0.5 hidden sm:flex items-center gap-2">
                                            AI-Powered Peer Evaluation
                                            {isOnline ? (
                                                <span className="flex items-center gap-1 text-green-400">
                                                    <Icons.Wifi /> Online
                                                </span>
                                            ) : (
                                                <span className="flex items-center gap-1 text-orange-400">
                                                    <Icons.WifiOff /> Offline
                                                </span>
                                            )}
                                        </p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2">
                                    <button
                                        onClick={() => setShowAIChat(true)}
                                        disabled={!isOnline}
                                        className="px-3 py-2 bg-gradient-to-r from-indigo-500/20 to-purple-500/20 hover:from-indigo-500/30 hover:to-purple-500/30 border border-indigo-500/30 text-indigo-300 rounded-xl transition-all flex items-center gap-2 text-sm backdrop-blur-sm shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                                    >
                                        <Icons.Brain />
                                        <span className="hidden sm:inline">AI Assistant</span>
                                    </button>
                                    <button
                                        onClick={() => setShowGuide(true)}
                                        className="px-3 py-2 bg-slate-800/80 hover:bg-slate-700/80 border border-slate-700/50 text-purple-300 rounded-xl transition-all flex items-center gap-2 text-sm backdrop-blur-sm"
                                    >
                                        <Icons.HelpCircle />
                                        <span className="hidden sm:inline">Guide</span>
                                    </button>
                                    <button
                                        onClick={exportToCSV}
                                        className="px-3 py-2 bg-slate-800/80 hover:bg-slate-700/80 border border-slate-700/50 text-cyan-300 rounded-xl transition-all flex items-center gap-2 text-sm backdrop-blur-sm"
                                    >
                                        <Icons.Download />
                                        <span className="hidden sm:inline">Export</span>
                                    </button>
                                    <button
                                        onClick={() => setShowAddClassmate(true)}
                                        className="relative group px-4 py-2.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 hover:from-indigo-600 hover:via-purple-600 hover:to-pink-600 text-white font-semibold rounded-xl transition-all flex items-center gap-2 shadow-lg shadow-indigo-500/30"
                                    >
                                        <div className="absolute inset-0 bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 rounded-xl blur opacity-0 group-hover:opacity-50 transition-opacity"></div>
                                        <Icons.Plus />
                                        <span className="text-sm sm:text-base relative z-10">Add</span>
                                    </button>
                                    <button
                                        onClick={() => setShowMobileMenu(!showMobileMenu)}
                                        className="lg:hidden p-2 hover:bg-slate-800/80 rounded-xl transition-colors backdrop-blur-sm border border-slate-700/50"
                                    >
                                        <Icons.Menu />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-8 relative z-10">
                        {/* Navigation */}
                        <nav className={`lg:flex gap-2 mb-6 ${showMobileMenu ? 'flex flex-col' : 'hidden'} lg:flex-row`}>
                            {[
                                { id: 'dashboard', icon: Icons.BarChart3, label: 'Dashboard', gradient: 'from-blue-500 to-cyan-500' },
                                { id: 'classmates', icon: Icons.Users, label: `Classmates (${classmates.length})`, gradient: 'from-purple-500 to-pink-500' },
                                { id: 'summary', icon: Icons.Award, label: 'Rankings', gradient: 'from-orange-500 to-red-500' },
                                { id: 'analytics', icon: Icons.TrendingUp, label: 'Analytics', gradient: 'from-green-500 to-emerald-500' }
                            ].map(nav => {
                                const NavIcon = nav.icon;
                                return (
                                    <button
                                        key={nav.id}
                                        onClick={() => { setActiveView(nav.id); setShowMobileMenu(false); }}
                                        className={`px-5 py-3 rounded-xl transition-all font-medium backdrop-blur-sm flex items-center gap-2 shadow-lg ${
                                            activeView === nav.id
                                                ? `bg-gradient-to-r ${nav.gradient} text-white`
                                                : 'bg-slate-800/50 text-slate-300 hover:bg-slate-800/80 hover:text-white border border-slate-700/50'
                                        }`}
                                    >
                                        <NavIcon />
                                        <span className="text-sm">{nav.label}</span>
                                    </button>
                                );
                            })}
                        </nav>
                        
                        {/* Dashboard View - Simplified for length */}
                        {activeView === 'dashboard' && (
                            <div className="space-y-6">
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                    {[
                                        { icon: Icons.Users, value: classmates.length, label: 'Total Classmates', gradient: 'from-blue-500 to-cyan-500' },
                                        { icon: Icons.BarChart3, value: evaluations.length, label: 'Total Evaluations', gradient: 'from-green-500 to-emerald-500' },
                                        { icon: Icons.Award, value: evaluations.length > 0 ? (evaluations.reduce((sum, e) => sum + e.overallScore, 0) / evaluations.length).toFixed(1) : '0.0', label: 'Average Score', gradient: 'from-purple-500 to-pink-500' },
                                        { icon: Icons.BookOpen, value: getClasses().length - 1, label: 'Classes', gradient: 'from-orange-500 to-red-500' }
                                    ].map((stat, idx) => {
                                        const StatIcon = stat.icon;
                                        return (
                                            <div key={idx} className="group relative">
                                                <div className="relative bg-slate-900/80 backdrop-blur-xl rounded-2xl p-6 border border-slate-700/50 hover:border-slate-600/50 transition-all shadow-xl">
                                                    <div className="flex items-center justify-between mb-3">
                                                        <div className={`p-3 bg-gradient-to-br ${stat.gradient}/20 rounded-xl`}>
                                                            <StatIcon />
                                                        </div>
                                                    </div>
                                                    <div className={`text-4xl font-bold bg-gradient-to-r ${stat.gradient} bg-clip-text text-transparent mb-1`}>
                                                        {stat.value}
                                                    </div>
                                                    <div className="text-slate-400 text-sm font-medium">{stat.label}</div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                
                                {/* AI Insights Banner */}
                                {evaluations.length > 0 && isOnline && (
                                    <div className="relative group">
                                        <div className="relative bg-gradient-to-r from-slate-900/80 via-indigo-900/50 to-slate-900/80 backdrop-blur-xl rounded-2xl p-6 border border-indigo-500/30 shadow-2xl">
                                            <div className="flex items-start gap-4">
                                                <div className="p-3 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-xl border border-indigo-500/30">
                                                    <Icons.Sparkles />
                                                </div>
                                                <div className="flex-1">
                                                    <h3 className="text-lg font-bold text-indigo-200 mb-2 flex items-center gap-2">
                                                        AI-Powered Insights
                                                        <Icons.Zap />
                                                    </h3>
                                                    <p className="text-slate-300 text-sm mb-4">
                                                        Get intelligent analysis of class performance, trends, and personalized recommendations powered by advanced AI.
                                                    </p>
                                                    <button
                                                        onClick={() => setShowAIChat(true)}
                                                        className="px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white rounded-lg text-sm font-medium transition-all shadow-lg flex items-center gap-2"
                                                    >
                                                        <Icons.Brain />
                                                        Ask AI Assistant
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                {/* Top Performers */}
                                <div className="relative group">
                                    <div className="relative bg-slate-900/80 backdrop-blur-xl rounded-2xl p-6 border border-slate-700/50 shadow-2xl">
                                        <h2 className="text-2xl font-bold mb-6 flex items-center gap-3">
                                            <div className="p-2 bg-gradient-to-br from-yellow-500/20 to-orange-500/20 rounded-xl">
                                                <Icons.Award />
                                            </div>
                                            <span className="bg-gradient-to-r from-yellow-300 to-orange-300 bg-clip-text text-transparent">Top Performers</span>
                                        </h2>
                                        {getTopPerformers().length > 0 ? (
                                            <div className="space-y-4">
                                                {getTopPerformers().map((classmate, index) => (
                                                    <div
                                                        key={classmate.id}
                                                        className="group/item relative cursor-pointer"
                                                        onClick={() => {
                                                            setSelectedClassmate(classmate);
                                                            setActiveView('classmateDetail');
                                                        }}
                                                    >
                                                        <div className="relative flex items-center justify-between p-5 bg-slate-800/50 rounded-xl border border-slate-700/30 hover:border-slate-600/50 transition-all backdrop-blur-sm">
                                                            <div className="flex items-center gap-5">
                                                                <div className={`relative w-14 h-14 rounded-2xl flex items-center justify-center font-bold text-xl shadow-2xl ${
                                                                    index === 0 ? 'bg-gradient-to-br from-yellow-400 via-orange-400 to-red-400 text-slate-950' :
                                                                    index === 1 ? 'bg-gradient-to-br from-slate-300 via-slate-400 to-slate-500 text-slate-950' :
                                                                    'bg-gradient-to-br from-orange-500 via-red-500 to-pink-500 text-white'
                                                                }`}>
                                                                    <span className="relative z-10">{index + 1}</span>
                                                                </div>
                                                                <div>
                                                                    <div className="font-bold text-lg text-slate-100 mb-1">{classmate.name}</div>
                                                                    <div className="flex items-center gap-2 text-sm text-slate-400">
                                                                        <span className="px-2 py-0.5 bg-indigo-500/20 rounded-md text-indigo-300 text-xs">{classmate.year}</span>
                                                                        <span>â€¢</span>
                                                                        <span className="px-2 py-0.5 bg-purple-500/20 rounded-md text-purple-300 text-xs">{classmate.classSection}</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div className="text-right">
                                                                <div className={`text-3xl font-bold mb-1 bg-gradient-to-r ${
                                                                    index === 0 ? 'from-yellow-300 to-orange-300' :
                                                                    index === 1 ? 'from-slate-300 to-slate-400' :
                                                                    'from-orange-300 to-red-300'
                                                                } bg-clip-text text-transparent`}>
                                                                    {classmate.avgScore.toFixed(1)}
                                                                </div>
                                                                <div className="text-xs text-slate-400 flex items-center gap-1">
                                                                    <Icons.BarChart3 />
                                                                    {classmate.evalCount} evaluations
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="text-center py-12 text-slate-400">
                                                <Icons.Award />
                                                <p className="text-lg mt-4">No evaluations yet</p>
                                                <p className="text-sm mt-2">Start evaluating your classmates to see top performers!</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* Other views would follow similar pattern - truncated for space */}
                        {/* Classmates, Summary, Analytics, Detail views... */}
                    </div>
                    
                    {/* Modals */}
                    {showAddClassmate && <AddClassmateModal onClose={() => setShowAddClassmate(false)} onAdd={addClassmate} />}
                    {showGuide && <GuideModal onClose={() => setShowGuide(false)} criteria={criteria} />}
                    {showAIChat && (
                        <AIChatModal
                            messages={aiChatMessages}
                            onClose={() => {
                                setShowAIChat(false);
                                setAiChatMessages([]);
                            }}
                            onSendMessage={handleAIChat}
                            loading={aiChatLoading}
                            input={aiChatInput}
                            setInput={setAiChatInput}
                        />
                    )}
                </div>
            );
        }
        
        // Modal Components
        function AddClassmateModal({ onClose, onAdd }) {
            const [name, setName] = useState('');
            const [year, setYear] = useState('');
            const [classSection, setClassSection] = useState('');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (name && year && classSection) {
                    onAdd(name, year, classSection);
                    setName('');
                    setYear('');
                    setClassSection('');
                }
            };
            
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={onClose}>
                    <div className="bg-slate-900 rounded-2xl p-8 max-w-md w-full border border-slate-700/50 shadow-2xl" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">Add New Classmate</h2>
                            <button onClick={onClose} className="p-2 hover:bg-slate-800 rounded-lg transition-colors">
                                <Icons.X />
                            </button>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-slate-300 mb-2">Full Name</label>
                                <input
                                    type="text"
                                    value={name}
                                    onChange={(e) => setName(e.target.value)}
                                    className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-slate-100 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20"
                                    placeholder="Enter classmate's name"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-300 mb-2">Year/Grade</label>
                                <input
                                    type="text"
                                    value={year}
                                    onChange={(e) => setYear(e.target.value)}
                                    className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-slate-100 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20"
                                    placeholder="e.g., Freshman, Sophomore"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-300 mb-2">Class/Section</label>
                                <input
                                    type="text"
                                    value={classSection}
                                    onChange={(e) => setClassSection(e.target.value)}
                                    className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-slate-100 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20"
                                    placeholder="e.g., Class A, Section 1"
                                    required
                                />
                            </div>
                            <div className="flex gap-3 mt-6">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 px-4 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl transition-all font-medium"
                                >
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    className="flex-1 px-4 py-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 hover:from-indigo-600 hover:via-purple-600 hover:to-pink-600 text-white rounded-xl transition-all font-medium shadow-lg"
                                >
                                    Add Classmate
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }
        
        function GuideModal({ onClose, criteria }) {
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto" onClick={onClose}>
                    <div className="bg-slate-900 rounded-2xl p-6 sm:p-8 max-w-3xl w-full border border-slate-700/50 shadow-2xl my-8" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">User Guide</h2>
                            <button onClick={onClose} className="p-2 hover:bg-slate-800 rounded-lg transition-colors">
                                <Icons.X />
                            </button>
                        </div>
                        
                        <div className="space-y-6 text-slate-300">
                            <section>
                                <h3 className="text-xl font-bold text-slate-100 mb-3 flex items-center gap-2">
                                    <Icons.Lightbulb />
                                    Getting Started
                                </h3>
                                <p className="mb-3">Welcome to ClassMate AI! This offline-capable app helps you evaluate and track classmates' performance.</p>
                                <ul className="space-y-2 ml-4">
                                    <li className="flex items-start gap-2">
                                        <Icons.CheckCircle />
                                        <span><strong>Works Offline:</strong> All data is stored locally on your device</span>
                                    </li>
                                    <li className="flex items-start gap-2">
                                        <Icons.CheckCircle />
                                        <span><strong>AI Features:</strong> Requires internet connection for AI insights</span>
                                    </li>
                                    <li className="flex items-start gap-2">
                                        <Icons.CheckCircle />
                                        <span><strong>Install as App:</strong> Click the install button to add to your home screen</span>
                                    </li>
                                </ul>
                            </section>
                            
                            <section>
                                <h3 className="text-xl font-bold text-slate-100 mb-3 flex items-center gap-2">
                                    <Icons.Sparkles />
                                    AI Features (Online Only)
                                </h3>
                                <div className="space-y-3">
                                    <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700/30">
                                        <h4 className="font-semibold text-indigo-300 mb-2">AI Assistant</h4>
                                        <p className="text-sm">Chat with AI to analyze trends and get personalized recommendations</p>
                                    </div>
                                    <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700/30">
                                        <h4 className="font-semibold text-indigo-300 mb-2">Smart Comments</h4>
                                        <p className="text-sm">Auto-generate constructive evaluation comments</p>
                                    </div>
                                    <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700/30">
                                        <h4 className="font-semibold text-indigo-300 mb-2">Performance Insights</h4>
                                        <p className="text-sm">Get AI analysis of student performance and trends</p>
                                    </div>
                                </div>
                            </section>
                        </div>
                        
                        <div className="mt-6 pt-6 border-t border-slate-700/50">
                            <button
                                onClick={onClose}
                                className="w-full px-4 py-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 hover:from-indigo-600 hover:via-purple-600 hover:to-pink-600 text-white rounded-xl transition-all font-medium shadow-lg"
                            >
                                Got it!
                            </button>
                        </div>
                    </div>
                </div>
            );
        }
        
        function AIChatModal({ messages, onClose, onSendMessage, loading, input, setInput }) {
            const messagesEndRef = useRef(null);
            
            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [messages]);
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (input.trim() && !loading) {
                    onSendMessage(input);
                }
            };
            
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={onClose}>
                    <div className="bg-slate-900 rounded-2xl max-w-3xl w-full h-[600px] border border-slate-700/50 shadow-2xl flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <div className="p-6 border-b border-slate-700/50">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-xl">
                                        <Icons.Brain />
                                    </div>
                                    <div>
                                        <h2 className="text-xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">AI Assistant</h2>
                                        <p className="text-xs text-slate-400">Ask me anything about your evaluations</p>
                                    </div>
                                </div>
                                <button onClick={onClose} className="p-2 hover:bg-slate-800 rounded-lg transition-colors">
                                    <Icons.X />
                                </button>
                            </div>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto p-6 space-y-4">
                            {messages.length === 0 ? (
                                <div className="text-center py-12">
                                    <div className="w-20 h-20 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <Icons.Brain />
                                    </div>
                                    <h3 className="text-lg font-semibold text-slate-200 mb-2">How can I help you today?</h3>
                                    <p className="text-sm text-slate-400">Ask me about trends, insights, or evaluation tips</p>
                                </div>
                            ) : (
                                messages.map((msg, idx) => (
                                    <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[80%] rounded-2xl p-4 ${
                                            msg.role === 'user' 
                                                ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white' 
                                                : 'bg-slate-800/50 text-slate-200 border border-slate-700/50'
                                        }`}>
                                            <p className="text-sm leading-relaxed whitespace-pre-wrap">{msg.content}</p>
                                        </div>
                                    </div>
                                ))
                            )}
                            {loading && (
                                <div className="flex justify-start">
                                    <div className="bg-slate-800/50 rounded-2xl p-4 border border-slate-700/50">
                                        <div className="flex items-center gap-2">
                                            <div className="w-2 h-2 bg-indigo-400 rounded-full animate-bounce"></div>
                                            <div className="w-2 h-2 bg-purple-400 rounded-full animate-bounce" style={{animationDelay: '150ms'}}></div>
                                            <div className="w-2 h-2 bg-pink-400 rounded-full animate-bounce" style={{animationDelay: '300ms'}}></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>
                        
                        <form onSubmit={handleSubmit} className="p-6 border-t border-slate-700/50">
                            <div className="flex gap-3">
                                <input
                                    type="text"
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    placeholder="Ask me anything..."
                                    disabled={loading}
                                    className="flex-1 px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-slate-100 placeholder-slate-400 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 disabled:opacity-50"
                                />
                                <button
                                    type="submit"
                                    disabled={loading || !input.trim()}
                                    className="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white rounded-xl transition-all font-medium shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                                >
                                    {loading ? (
                                        <div className="w-5 h-5 spinner"></div>
                                    ) : (
                                        <>
                                            <Icons.Zap />
                                            <span>Send</span>
                                        </>
                                    )}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }
        
        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // PWA Install
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installButton = document.getElementById('installButton');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPrompt.classList.remove('hidden');
        });
        
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                deferredPrompt = null;
                installPrompt.classList.add('hidden');
            }
        });
        
        window.addEventListener('appinstalled', () => {
            console.log('PWA installed successfully!');
            installPrompt.classList.add('hidden');
        });
        
        // Register Service Worker for offline functionality
        if ('serviceWorker' in navigator) {
            // Simple service worker inline
            const swCode = `
                const CACHE_NAME = 'classmate-ai-v1';
                const urlsToCache = ['/'];
                
                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(urlsToCache))
                    );
                });
                
                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => response || fetch(event.request))
                            .catch(() => caches.match('/'))
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(registration => console.log('Service Worker registered:', registration))
                .catch(error => console.log('Service Worker registration failed:', error));
        }
    </script>
</body>
</html>
